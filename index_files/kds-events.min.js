kds.version="1.9.4";(function(c,d,e,t){var i,o,n,a,s,r,l;var p=";";function m(e,t){if(l&&l.DEBUG===true){console.log(e,t)}}function f(e){var i=Math.round(Date.now()/1e3);var t="krg_bid";var r="krg_ctx";var n="krg_tc_d";var a=5;var s=30*60;var c=function(){var e=localStorage.getItem(n);try{if(e){return JSON.parse(e)}}catch(e){localStorage.removeItem(n)}return null};var d=function(e){localStorage.setItem(n,JSON.stringify(e))};var o=function(e){e.hasFired=true;d(e);kds("track","TrueClick",{id:e.krgBid});if(e.ctx!==undefined&&e.ctx.length>0){y(e.ctx)}};var l=function(e,t){var r={timestamp:i,krgBid:e,ctx:t,hasFired:false};d(r);return r};var p=function(e,t){setTimeout(function(){o(e)},t*1e3)};var m=new URLSearchParams(e.location.search);var f=m.get(t)||m.get(KRG_IMP_ID)||"";var v=m.get(r)||"";var k=c();if(k&&(f&&k.krgBid==f||!f)){if(k.hasFired)return;if(i-k.timestamp>s)return;p(k,Math.max(0,a-(i-k.timestamp)));return}if(f){p(l(f,v),a);return}}function v(){c.KARGO=c.KARGO||{};c.KARGO.kds=c.KARGO.kds||{};l=c.KARGO.kds;m("Initializing KDS Events.");o=l.PIXEL_COOKIE||"krg_pixel";n=l.KTC_ID||"ktcid";a=l.KTCT_ID||"ktctid";EVENTS_URL=l.EVENTS_URL||"//kds-pixel.kargo.com";PEGASUS_HOST=l.PEGASUS_HOST||"//pgsb.kargo.com";KRG_IMP_ID=l.KRG_IMP_ID||"krg_imp_id";if(EVENTS_URL&&EVENTS_URL.length>0){i=e.protocol+EVENTS_URL+"/api/v1"}D(c.kds.queue);c.kds.callMethod=T;c.kds.relayCallMethod=x}function k(e){kimp=u();c.KARGO.kds.partnerId=e;c.KARGO.kds.viewId=U();var t=g(o);if(!t){t=U();K(o,t,S())}s=l.CERB_SYNC_ENABLED!="false"&&!h();if(s){var r=d.createElement("iframe");r.style.cssText="display:none;";cerbUrl=l.TAPAD_CERB_URL||"https://crb.kargo.com";r.src=cerbUrl+"/api/v1/initsync/"+g(o)+"?partners=Tapad";d.body.appendChild(r);K("cerb_tapad","1",S())}var i={partner_id:e,client_id:t,ktc_id:R(n),ktct_id:R(a),kimp:kimp,event:"init",client_referer:d.referrer,params:{view_id:c.KARGO.kds.viewId}};I(i);f(c);if(kimp){A()}}function u(){try{lsKimp=c.localStorage.getItem("kimp");pkimp=new URL(c.top.location.href).searchParams.get(KRG_IMP_ID);vlsKimp=_(lsKimp);vpkimp=_(pkimp);if(!vlsKimp&&!vpkimp){return""}if(vlsKimp&&!vpkimp){return lsKimp}if(!vlsKimp&&vpkimp){try{c.localStorage.setItem("kimp",pkimp)}catch(e){L(e,pkimp)}return pkimp}if(vlsKimp&&vpkimp){if(lsKimp===pkimp){return lsKimp}else{try{c.localStorage.setItem("kimp",pkimp)}catch(e){L(e,pkimp)}return pkimp}}return""}catch(e){return""}}function g(e){var t=R(e);if(t&&t.trim()!=""){return t}var r=c.localStorage.getItem(e);if(r&&r.trim()!=""){return r}return t}function _(e){return e&&e.length<=38&&e.length>=36}function h(){return R("cerb_tapad")==="1"||c.localStorage.getItem("cerb_tapad")==="1"}function K(t,r,i){if(!c.navigator.cookieEnabled||c.localStorage){try{c.localStorage.setItem(t,r)}catch(e){O(t,r,i)}}else{O(t,r,i)}}function O(e,t,r){var i=e+"="+t+p+"domain="+r+p+"path=/"+p+"max-age=31536000"+p+"SameSite=Lax";d.cookie=i;return i}function R(e){var t=e+"=";var r=d.cookie.split(";");for(var i=0;i<r.length;i++){var n=r[i];while(n.charAt(0)==" ")n=n.substring(1,n.length);if(n.indexOf(t)==0)return n.substring(t.length,n.length)}return undefined}function S(){var e=d.domain;try{return e.substring(e.indexOf("."),e.length)}catch(e){return d.domain}}function A(){if(!c.KARGO.kds.viewtime){c.KARGO.kds.viewtime=c.KARGO.kds.viewtime||1;c.KARGO.kds.timer=c.setInterval(G,1e3*5);return}}function G(){c.KARGO.kds.viewtime=c.KARGO.kds.viewtime||1;var e={partner_id:c.KARGO.kds.partnerId,client_id:g(o),event:"T"+c.KARGO.kds.viewtime*5,kimp:kimp=u(),client_referer:d.referrer,params:{view_id:c.KARGO.kds.viewId}};I(e);if(c.KARGO.kds.viewtime&&c.KARGO.kds.viewtime>=2){c.clearInterval(c.KARGO.kds.timer)}c.KARGO.kds.viewtime=c.KARGO.kds.viewtime+1}function I(e){if(!i){m("Mising EVENTS_URL, request will not be sent.");return}var t=false;if(c.navigator.sendBeacon){e.meta="b";t=c.navigator.sendBeacon(i,JSON.stringify(e))}if(!c.navigator.sendBeacon||!t){e.meta="x";var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState===4){if(r.status!=200&&r.status!="OK"){e.meta="x - i;"+r.status;w(e)}}};r.open("POST",i,true);r.withCredentials=true;r.send(JSON.stringify(e))}}function w(e){c.KARGO.kds.viewId=c.KARGO.kds.viewId||U();var t=d.createElement("img");t.style.cssText="display:none;";t.src=i+"/track?"+E(e);d.body.appendChild(t)}function y(e){c.KARGO.kds.viewId=c.KARGO.kds.viewId||U();var t=d.createElement("img");t.style.cssText="display:none;";t.src="https:"+PEGASUS_HOST+"/api/v1/true-click?"+E({ctx:e});d.body.appendChild(t)}function E(e){return b("",e)+"&cid="+Math.random()}function b(r,i){Object.keys(i).forEach(function(e){if(e!="client_referer"){if(i[e]){var t=i[e];if(t.toString()==="[object Object]"){r=b(r,t)}else{r=r+e+"="+t+"&"}}}});return r}function T(e){try{var t=Array.prototype.slice.call(arguments);e=t.shift();switch(e){case"init":k.apply(this,t);break;case"track":M(this,e,t);break}}catch(e){L(e,u())}}function x(e){kds.callMethod.apply(this,e)}function L(e,t){I({partner_id:c.KARGO.kds.partnerId,client_id:g(o),ktc_id:R(n),ktct_id:R(a),kimp:t,event:"Error",params:{name:e.name,message:e.message,view_id:c.KARGO.kds.viewId},client_referer:d.referrer})}function M(e,t,r){var i=r[0];var n=r.length===1?{}:r[1];var a=g(o);if(!a){a=U();K(o,a,S())}n.view_id=c.KARGO.kds.viewId;var s={partner_id:c.KARGO.kds.partnerId,client_id:a,event:i,kimp:u(),params:n,client_referer:d.referrer};I(s)}function U(){return C()+C()+"-"+C()+"-"+C()+"-"+C()+"-"+C()+C()+C()}function C(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}function D(e){while(e.length){var t=e.shift();T.apply(c.kds,t)}}if(d.readyState!=="loading"){v()}else{d.addEventListener("DOMContentLoaded",v)}})(window,document,location);